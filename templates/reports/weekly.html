{% extends "base.html" %}

{% block title %}Weekly Report - CSR Volunteering System{% endblock %}

{% block content %}
<div class="page-header">
    <h1>
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
            style="display: inline-block; vertical-align: middle; margin-right: 8px;">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
            <line x1="16" y1="2" x2="16" y2="6"></line>
            <line x1="8" y1="2" x2="8" y2="6"></line>
            <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        Weekly Report
    </h1>
    <div class="page-actions">
        <form method="GET" action="{{ url_for('createWeeklyReport') }}" style="display: inline-block;">
            <input type="date" name="date" value="{{ report.report_date.strftime('%Y-%m-%d') }}"
                   class="form-control" style="display: inline-block; width: auto; margin-right: 8px;">
            <button type="submit" class="btn btn-secondary">View Week</button>
        </form>
        <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">← Back to Dashboard</a>
    </div>
</div>

<div class="report-container">
    <div class="report-header">
        <h2>Week of {{ report.week_start.strftime('%B %d, %Y') }} – {{ report.week_end.strftime('%B %d, %Y') }}</h2>
        <p class="text-muted">Comparison with previous week</p>
    </div>

    <div class="stats-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; margin: 2rem 0;">
        {% for key, change in report.changes.items() %}
        <div class="stat-card" style="background: white; padding: 1.5rem; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
            <div class="stat-label" style="font-size: 0.9rem; color: #666; margin-bottom: 0.5rem;">
                {{ key.replace('_', ' ')|title }}
            </div>
            <div class="stat-value" style="font-size: 2rem; font-weight: bold; margin-bottom: 0.5rem;">
                {{ change.value }}
            </div>
            {% if change.change is not none %}
            <div class="stat-change" style="font-size: 0.85rem;">
                {% if change.trend == 'increase' %}
                    <span style="color: #28a745;">↑ +{{ change.change }} (+{{ change.change_percent }}%)</span>
                {% elif change.trend == 'decrease' %}
                    <span style="color: #dc3545;">↓ {{ change.change }} ({{ change.change_percent }}%)</span>
                {% else %}
                    <span style="color: #6c757d;">→ No change</span>
                {% endif %}
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>

    <div class="category-breakdown" style="margin-top: 2rem;">
        <h3>Activity by Category (Weekly)</h3>
        <div class="table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Category</th>
                        <th>New Requests</th>
                        <th>Completed Requests</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% if report.category_breakdown %}
                        {% for cat in report.category_breakdown %}
                        <tr>
                            <td><strong>{{ cat.category_title }}</strong></td>
                            <td>{{ cat.new_requests }}</td>
                            <td>{{ cat.completed_requests }}</td>
                            <td>
                                {% if cat.is_active %}
                                    <span class="badge badge-success">Active</span>
                                {% else %}
                                    <span class="badge badge-danger">Suspended</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="4" style="text-align: center; color: #999;">No category activity for this week</td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </div>

    <div class="report-summary" style="margin-top: 2rem; padding: 1.5rem; background: #f8f9fa; border-radius: 8px;">
        <h3>Summary</h3>
        <ul style="list-style: none; padding: 0;">
            <li style="margin: 0.5rem 0;">
                <strong>Total Requests (All Time):</strong> {{ report.current_stats.total_requests }}
            </li>
            <li style="margin: 0.5rem 0;">
                <strong>Pending Requests (Current):</strong> {{ report.current_stats.pending_requests }}
            </li>
            <li style="margin: 0.5rem 0;">
                <strong>Week Selected:</strong> {{ report.week_start.strftime('%Y-%m-%d') }} to {{ report.week_end.strftime('%Y-%m-%d') }}
            </li>
        </ul>
    </div>
</div>
{% endblock %}


