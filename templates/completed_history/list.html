{% extends "base.html" %}

{% block title %}Completed Match History - CSR Volunteering System{% endblock %}

{% block content %}
<div class="page-header">
    <h1>
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: inline-block; vertical-align: middle; margin-right: 8px;">
            <path d="M9 11l3 3L22 4"></path>
            <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
        </svg>
        Completed Match History
    </h1>
    <div class="page-actions">
        <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">← Back to Dashboard</a>
    </div>
</div>

{% if total_count == 0 %}
<div class="empty-state">
    <p>No completed matches found.</p>
    <p>You haven't received any completed assistance yet.</p>
</div>
{% else %}
<div class="table-container">
    <table class="data-table">
        <thead>
            <tr>
                <th>Match ID</th>
                <th>Request Title</th>
                <th>Service Type</th>
                <th>Volunteer</th>
                <th>Completed At</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for item in items %}
            <tr>
                <td>{{ item.match_id }}</td>
                <td>
                    {% if item.request %}
                        <strong>{{ item.request.title }}</strong>
                    {% else %}
                        <em>Request not found</em>
                    {% endif %}
                </td>
                <td>{{ item.service_type or 'N/A' }}</td>
                <td>
                    {% if item.csr_rep %}
                        {{ item.csr_rep.first_name }} {{ item.csr_rep.last_name }}
                    {% else %}
                        <em>Unknown</em>
                    {% endif %}
                </td>
                <td>
                    {% if item.completed_at %}
                        {{ item.completed_at.strftime('%Y-%m-%d %H:%M') }}
                    {% else %}
                        {{ item.created_at.strftime('%Y-%m-%d %H:%M') }}
                    {% endif %}
                </td>
                <td class="table-actions">
                    <span class="badge badge-success">Completed</span>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% if page_meta.totalPages > 1 %}
<div class="pagination">
    <div class="pagination-info">
        Showing {{ page_meta.offset + 1 }} to {{ [page_meta.offset + page_meta.limit, page_meta.totalCount]|min }} 
        of {{ page_meta.totalCount }} completed matches
    </div>
    <div class="pagination-controls">
        {% if page_meta.hasPrev %}
        <a href="{{ url_for('viewCompletedHistory', page=page_meta.page - 1) }}" class="btn btn-sm btn-secondary">← Previous</a>
        {% endif %}
        
        <span class="page-info">Page {{ page_meta.page }} of {{ page_meta.totalPages }}</span>
        
        {% if page_meta.hasNext %}
        <a href="{{ url_for('viewCompletedHistory', page=page_meta.page + 1) }}" class="btn btn-sm btn-secondary">Next →</a>
        {% endif %}
    </div>
</div>
{% else %}
<div class="table-info">
    <p>Total: {{ total_count }} completed match{{ 'es' if total_count != 1 else '' }}</p>
</div>
{% endif %}
{% endif %}
{% endblock %}

